<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width" />

    <style>
      body { font-family: Tahoma, Geneva, sans-serif; text-align: center; }
    </style>

    <script type="text/javascript" src="https://raw.githack.com/colyseus/colyseus.js/master/dist/colyseus.js"></script>

    <style type="text/css">
      .player {
        width: 100px;
        height: 100px;
        position: absolute;
        border-radius: 50%;
        border: 5px solid black;
        padding-top: 24px;
        box-sizing: border-box;
        left: 0;
        top: 0;
      }
    </style>

  </head>
  <body>
    <script>
        var host = window.document.location.host.replace(/:.*/, '');

        var client = new Colyseus.Client(location.protocol.replace("http", "ws") + "//" + host + (location.port ? ':' + location.port : ''));
        var room;
        client.joinOrCreate("Game").then(room_instance => {
            room = room_instance

            var players = {};

            // listen to patches coming from the server
            room.state.players.onAdd = function (player, sessionId) {
                var dom = document.createElement("div");
                dom.className = "player";
                dom.style.left = player.x + "px";
                dom.style.top = player.y + "px";
                dom.style.background = player.color;

                players[sessionId] = dom;
                document.body.appendChild(dom);
            }

            room.state.players.onRemove = function (player, sessionId) {
                document.body.removeChild(players[sessionId]);
                delete players[sessionId];
            }

            room.state.players.onChange = function (player, sessionId) {
                var dom = players[sessionId];
                dom.style.left = player.x + "px";
                dom.style.top = player.y + "px";
            }

            window.addEventListener("keydown", function (e) {
                room.send({id: "KeyDown", data:{key: e.which}});
            });

            window.addEventListener("keyup", function(e) {
                room.send({id: "KeyUp", data:{key: e.which}});
            });

        });
    </script>
  </body>
</html>
